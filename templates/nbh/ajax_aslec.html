{% extends 'templates/index.html' %}
{% load static %}
{% load SelfDefinedFilter%}
{% block title %}青少年生活事件量表{% endblock %}
{% block css %}
    <link href="{% static '/css/scales_style.css' %}" rel="stylesheet" >
{% endblock %}
{% block content %}
    <div class="right_col" role="main" >
        <div class="container">
            <div class="row show-grid">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <ul class="breadcrumb" style="background-color: white;font-weight:bold">
                         <li >量表录入</li>
                         <li>自评量表</li>
						 <li class="active">青少年生活事件量表</li>
						 <div style="float: right;margin-bottom: 0;"></div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="dashboard_graph x_panel" style="margin-top: 0;height:80%;">
			<div class="row"  style="margin-left:5px;margin-top: 5px;padding-bottom: 5px;">
				<div align="center" style="padding-left: 22.5%; padding-right: 22.5%">
					<h5>
						<strong>
							<i class="fa fa-hand-o-down"></i>&nbsp;
							<i class="fa fa-hand-o-down"></i>&nbsp;
							<i class="fa fa-hand-o-down"></i>&nbsp;
							指导语：过去12个月内，你和你的家庭是否发生过下列事件？请仔细阅读下列每一个项目，如发生过，并根据事件给你造成的苦恼程度在相对方格内打个勾 。如果某件事未发生，仅在事件未发生栏内打个勾就可以了。
						</strong>
					</h5>
				</div>
			</div>
            <div class="question_area" name="question_area" style="text-align: center">
                <form id="question_form" name="question_form" action="#">
					{% csrf_token %}
                    <h3><div name="question_test" id="question_test" class="row">1.被人误会或错怪</div></h3>
                    <div style="text-align: left;padding-left: 40%">
                            <label>未发生过：</label>
                    </div>
                    <div id="options_1" class="options" style=" text-align: left;padding-left: 47.5%">
                        <div class="row show-grid" style="margin:10px">
                            <label>
                                <input type="radio" name="answer" value=0 data-labelauty="未发生" />
                            </label>
                        </div>
                    </div>
                    <div style="text-align: left;padding-left: 40%">
                            <label>发生过，对您的影响程度：</label>
                        </div>
                    <div  id="options_2" class="options" style=" text-align: left;padding-left: 47.5%">

                        <div class="row show-grid" style="margin:10px">
                            <label>
                                <input type="radio" name="answer" value=1 data-labelauty="没有" />
                            </label>
                        </div>
						<div class="row show-grid" style="margin:10px">
							<label>
                                <input type="radio" name="answer" value=2 data-labelauty="轻度"/>
							</label>
						</div>
                        <div class="row show-grid" style="margin:10px">
							<label>
                                <input type="radio" name="answer" value=3 data-labelauty="中度" />
							</label>
						</div>
						<div class="row show-grid" style="margin:10px">
							<label>
                                <input type="radio" name="answer" value=4 data-labelauty="重度"/>
							</label>
						</div>
                        <div class="row show-grid" style="margin:10px">
							<label>
                                <input type="radio" name="answer" value=5 data-labelauty="极重"/>
							</label>
						</div>
                    </div>
                    <div>
                        <input id="question_submit" type="button" class="btn btn-success text-center" style="width:68px;height:34px" value="下一题">
                        <input type="button" class="btn btn-warning text-center" style="width:68px;height:34px" value="退&nbsp;&nbsp;出">
                    </div>
                </form>
            </div>
    </div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static '/js/jquery-radio-beauty.js'%}"></script>
<script>
	let time = new Date();
	let suicide = false;
    let question_index = 1;
	$(document).ready(function(){
		$("input[type='radio']").labelauty();

		$("#question_submit").on('click', function(){
			if (document.question_form.answer.value==="") {
                alert("问题不能为空！");
            }else{
                ajax_post($('#question_form'));
                update_question(question_index);
                question_index ++;
			}
		});
	});

	function get_duration(){
		const current_time = new Date();
		const duration = time - current_time;
		time = current_time;
		return -duration;
	}

	function update_question(index){
	    switch (index) {
            case 1:
                document.getElementById('question_test').innerHTML="2.受人歧视冷遇";break;
            case 2:
                document.getElementById('question_test').innerHTML="3.考试失败或不理想";break;
            case 3:
                document.getElementById('question_test').innerHTML="4.与同学或好友发生纠纷";break;
            case 4:
                document.getElementById('question_test').innerHTML="5.生活习惯（饮食、休息等）明显变化";break;
            case 5:
                document.getElementById('question_test').innerHTML="6.不喜欢上学";break;
            case 6:
                document.getElementById('question_test').innerHTML="7.恋爱不顺利或失恋";break;
            case 7:
                document.getElementById('question_test').innerHTML="8.长期远离家人不能团聚";break;
            case 8:
                document.getElementById('question_test').innerHTML="9.学生负担重";break;
            case 9:
                document.getElementById('question_test').innerHTML="10.与老师关系紧张";break;
            case 10:
                document.getElementById('question_test').innerHTML="11.本人患急重病";break;
            case 11:
                document.getElementById('question_test').innerHTML="12.亲友患急重病";break;
            case 12:
                document.getElementById('question_test').innerHTML="13.亲友死亡";break;
            case 13:
                document.getElementById('question_test').innerHTML="14.被盗或丢失东西";break;
            case 14:
                document.getElementById('question_test').innerHTML="15.当众丢面子";break;
            case 15:
                document.getElementById('question_test').innerHTML="16.家庭经济困难";break;
            case 16:
                document.getElementById('question_test').innerHTML="17.家庭内部有矛盾";break;
            case 17:
                document.getElementById('question_test').innerHTML="18.预期评选（如三好学生）落空";break;
            case 18:
                document.getElementById('question_test').innerHTML="19.受批评或处分";break;
            case 19:
                document.getElementById('question_test').innerHTML="20.转学或休学";break;
            case 20:
                document.getElementById('question_test').innerHTML="21.被罚款";break;
            case 21:
                document.getElementById('question_test').innerHTML="22.升学压力";break;
            case 22:
                document.getElementById('question_test').innerHTML="23.与人打架";break;
            case 23:
                document.getElementById('question_test').innerHTML="24.遭父母打骂";break;
            case 24:
                document.getElementById('question_test').innerHTML="25.家庭给你施加学习压力";break;
            case 25:
                document.getElementById('question_test').innerHTML="26.意外惊吓，事故";break;
            case 26:
                document.getElementById('question_test').innerHTML="27.如有其他事件说明";break;
        }
    }

	function ajax_post(form){
		const csrf = $('input[name="csrfmiddlewaretoken"]').val();
		$.ajax({
		url: 'http://127.0.0.1:8000/scales/test_submit',
		type: 'POST',
		dataType: 'JSON',
		async:true,
		data: {'data':form.serialize(),
            'question_index': question_index,
			'duration':get_duration(),
			'csrfmiddlewaretoken': csrf
			}
		})
	}

</script>

{% endblock %}