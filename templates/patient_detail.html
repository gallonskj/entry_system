{% extends 'templates/index.html' %}
{% load static %}
{% block title %}新建被试{% endblock %}
{% block css %}
    <link href="{% static '/css/scales_style.css' %}" rel="stylesheet" >
    <link href="{% static '/vendors/iCheck/skins/flat/green.css' %}" rel="stylesheet" >
    <style>
        .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
            padding:4px;
            vertical-align:middle;
            font-size: 10px;
            text-align: center;
        }
    </style>
{% endblock %}
{% block content %}
{% load SelfDefinedFilter %}
{% for session_id, session_details in patients_states.items %}

    <!-- 个人一般量表详细模态框 开始 -->
        <div class="modal fade" id="modal_DetailInfo_{{ session_id }}" role="dialog" aria-labelledby="myModalLabel"aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="" method="post">
                            <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h4 class="modal-title">
                                    个人一般信息列表
                                </h4>
                            </div>
                            <div class="modal-body">
                                <div class = "row">
                                    <div class="col-md-12">
                                        <table class="table table-hover table-bordered"  style="font-size: 10px;" >
                                              <thead>
                                                <tr>
                                                  <th>测查种类</th>
                                                  <th>测查时间</th>
                                                  <th>状态</th>
                                                  <th>重做</th>
                                                  <th>操作</th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                              {% for scale_id, scale_detail in session_details.items %}
                                                    {% if scale_id < 7 %}
                                                    <tr>
                                                      <td>{{ scale_detail|get_item:'scale__scale_name' }}</td>
                                                        {% if scale_detail.state == 1 %}
                                                            <td>{{ scale_detail|get_item:'end_time' }}</td>
                                                            <td>已完成</td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                        {% else %}
                                                            <td>-</td>
                                                            <td>未完成</td>
                                                            <td><a href="">续做</a></td>
                                                            <td><button class="btn btn-xs btn-warning"><a href="" style="color:white">删除</a></button></td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endif %}
                                              {% endfor %}
                                              </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
        </div>
    <!-- 个人一般量表详细模态框 结束-->
    <!-- 自测表量表详细模态框 开始 -->
        <div class="modal fade" id="modal_SelfTest_{{ session_id }}" role="dialog" aria-labelledby="myModalLabel"aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="" method="post">
                            <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h4 class="modal-title">
                                    自测量表信息列表
                                </h4>
                            </div>
                            <div class="modal-body">
                                <div class = "row">
                                    <div class="col-md-12">
                                        <table class="table table-hover table-bordered"  style="font-size: 10px;" >
                                              <thead>
                                                <tr>
                                                  <th>测查种类</th>
                                                  <th>测查时间</th>
                                                  <th>状态</th>
                                                  <th>续做</th>
                                                  <th>操作</th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                               {% for scale_id, scale_detail in session_details.items %}
                                                    {% if scale_id < 17 and scale_id > 6  %}
                                                    <tr>
                                                      <td>{{ scale_detail|get_item:'scale__scale_name' }}</td>
                                                        {% if each_test.test_state == 1 %}
                                                            <td>{{ scale_detail|get_item:'end_time' }}</td>
                                                            <td>已完成</td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                        {% else %}
                                                            <td>-</td>
                                                            <td>未完成</td>
                                                            <td><a href="">续做</a></td>
                                                            <td><button class="btn btn-xs btn-warning"><a href="" style="color:white">删除</a></button></td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endif %}
                                              {% endfor %}
                                              </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
        </div>
    <!-- 自测表量表详细模态框 结束-->
    <!-- 他测表量表详细模态框 开始 -->
        <div class="modal fade" id="modal_OtherTest_{{ session_id }}" role="dialog" aria-labelledby="myModalLabel"aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="" method="post">
                            <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h4 class="modal-title" id="myModalLabel">
                                    他测量表信息列表
                                </h4>
                            </div>
                            <div class="modal-body">
                                <div class = "row">
                                    <div class="col-md-12">
                                        <table class="table table-hover table-bordered"  style="font-size: 10px;" >
                                              <thead>
                                                <tr>
                                                  <th>测查种类</th>
                                                  <th>测查时间</th>
                                                  <th>状态</th>
                                                  <th>重做</th>
                                                  <th>操作</th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                                  {% for scale_id, scale_detail in session_details.items %}
                                                      {% if scale_id < 21 and scale_id > 16 %}
                                                        <tr>
                                                          <td>{{ scale_detail|get_item:'scale__scale_name' }}</td>
                                                            {% if each_test.test_state == 1 %}
                                                                <td>{{ scale_detail|get_item:'end_time' }}</td>
                                                                <td>已完成</td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                            {% else %}
                                                                <td>-</td>
                                                                <td>未完成</td>
                                                                <td><a href="">续做</a></td>
                                                                <td><button class="btn btn-xs btn-warning"><a href="" style="color:white">删除</a></button></td>
                                                            {% endif %}
                                                        </tr>
                                                      {% endif %}
                                                  {% endfor %}
                                              </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
        </div>
    <!-- 他测表量表详细模态框 结束-->
    <!-- 认知表量表详细模态框 开始 -->
        <div class="modal fade" id="modal_cognitionTest_{{ session_id }}" role="dialog" aria-labelledby="myModalLabel"aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="" method="post">
                            <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h4 class="modal-title" >
                                    认知量表信息列表
                                </h4>
                            </div>
                            <div class="modal-body">
                                <div class = "row">
                                    <div class="col-md-12">
                                        <table class="table table-hover table-bordered"  style="font-size: 10px;" >
                                              <thead>
                                                <tr>
                                                  <th>测查种类</th>
                                                  <th>测查时间</th>
                                                  <th>状态</th>
                                                  <th>续做</th>
                                                  <th>操作</th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                                {% for scale_id, scale_detail in session_details.items %}
                                                    {% if scale_id > 20 and scale_id < 25 %}
                                                    <tr>
                                                      <td>{{ scale_detail|get_item:'scale__scale_name' }}</td>
                                                        {% if each_test.test_state == 1 %}
                                                            <td>{{ scale_detail|get_item:'end_time' }}</td>
                                                            <td>已完成</td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                        {% else %}
                                                            <td>-</td>
                                                            <td>未完成</td>
                                                            <td><a href="">续做</a></td>
                                                            <td><button class="btn btn-xs btn-warning"><a href="" style="color:white">删除</a></button></td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endif %}
                                              {% endfor %}
                                              </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
        </div>
    <!-- 认知表量表详细模态框 结束-->
{% endfor %}

    <div class="right_col" role="main">
        <div class="row " style="margin-left:-20px">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <ul class="breadcrumb" style="background-color: white;font-weight:bold">
                     <li><a href="/patients/subjectManage">被试管理</a></li>
                     <li class="active" ><a href="#">信息录入</a></li>
                </ul>
            </div>
        </div>
        <div class="row x_panel">
            <div class="col-md-12 col-xs-12">
                <div class="x_panel" >
                    <div class="x_title">
                        <h2>个人信息<small>基本信息</small></h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                    <br />
                    <div class="form-horizontal form-label-left">
                      <div class="row">
                        <label class="control-label col-md-2 col-sm-2 col-xs-12" for="patient_id"> 受试编号 <span class="required">*:</span>
                        </label>
                        <div id="patient_id" class="col-md-4 col-sm-4 col-xs-12" style="padding-top: 7px;margin-bottom: 0;text-align: left">
                            {{ patient_id }}
                        </div>
                        <label class="control-label col-md-2 col-sm-2 col-xs-12" for="name">姓名 <span class="required">*:</span>
                        </label>
                        <div id="name" class="col-md-4 col-sm-4 col-xs-12" style="padding-top: 7px;margin-bottom: 0;text-align: left">
                            <div class="col-sm-4"><input type="text" class="form-control input-sm" name="name" required="required" value="{{ name }}" /></div>
                        </div>
                      </div>
                      <div class="row">
                        <label for="birth_date" class="control-label col-md-2 col-sm-2 col-xs-12">出生日期 <span class="required">*:</span></label>
                            <div id="birth_date" class="col-sm-4" ><input  id="birth_date_input" type="date" class="form-control input-sm" name="birth_date"
                                                             required="required" value="{{ birth_date }}"  /></div>
                        <label class="control-label col-md-2 col-sm-2 col-xs-6" for="sex">性别 <span class="required">*:</span></label>
                                     {% if sex == 0 %}
                                          <div class="col-md-2 col-sm-3 form-group has-feedback row" style="width: 7%;">
                                              <input type="radio" name="gender" value=0 data-labelauty="男" checked />
                                          </div>
                                          <div class="col-md-2 col-sm-3 form-group has-feedback row" style="width: 7%;">
                                              <input type="radio" name="gender" value=1 data-labelauty="女"/>
                                          </div>
                                      {% else %}
                                          <div class="col-md-2 col-sm-3 form-group has-feedback row" style="width: 7%;">
                                              <input type="radio" name="gender" value=0 data-labelauty="男" />
                                          </div>
                                          <div class="col-md-2 col-sm-3 form-group has-feedback row" style="width: 7%;">
                                              <input type="radio" name="gender" value=1 data-labelauty="女" checked/>
                                          </div>
                                      {% endif %}
                      </div>
                      <div class="row">
                        <label class="control-label col-md-2 col-sm-2 col-xs-12">民族 <span class="required">*:</span>
                        </label>
                        <div class="col-md-4 col-sm-4 col-xs-12" style="padding-top: 7px;margin-bottom: 0;text-align: left">
                            <select class="form-control" name="nation" id="nation">
                              {% for items in nation_list %}
                                {% if items.ethnicity_name == base_info.nation %}
                                <option value="{{items.id}}"  selected="true">{{items.ethnicity_name}}={{items.id}}</option>
                                {% else %}
                                <option value="{{items.id}}">{{items.ethnicity_name}}={{items.id}}</option>
                                {% endif %}
                              }
                              {% endfor %}
                            </select>
                        </div>
                      </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row x_panel">
            <div class="col-md-12 col-xs-12">
                <div class="x_panel" >
                    <div class="x_title">
                        <h2>复扫信息</h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                    <br/>
                        <div class="row clearfix">
			                <div class="col-md-12 column">
				                <table  id="datatable" class="table table-striped table-hover" style="font-size: 13px;cellspacing:15px;">
					                <thead>
						                <tr>
							                <th>
								                复扫编号
							                </th>
							                <th>
								                复扫时间
							                </th>
							                <th>
								                诊断
							                </th>
							                <th>
								                医生
							                </th>
							                <th>
								                一般信息表测查
							                </th>
							                <th>
							                    他评测查
							                </th>
                                            <th>
							                    自评测查
							                </th>
                                            <th>
							                    认知测查
							                </th>
                                            <th>
                                                操作
                                            </th>
						                </tr>
					                </thead>
					                <tbody>

                                        {% for patient_detail in patient_detail_res %}

                                            {% if patient_detail|get_item:'session_id'|divisibleby:"2" %}
                                                <tr class="success">
                                            {% else %}
                                                <tr >
                                            {% endif %}
                                                <td>
                                                    {{ patient_detail|get_item:'standard_id' }}
                                                </td>
                                                <td>
                                                    {{ patient_detail|get_item:'create_time' }}
                                                </td>
                                                <td>
                                                    {{ patient_detail|get_diagnosis_by_dict }}
                                                </td>
                                                <td>
                                                    {{ patient_detail|get_item:'doctor__name' }}
                                                </td>
                                                <td>
                                                    <a href="#modal_DetailInfo_{{ patient_detail|get_item:'session_id' }}" data-toggle="modal" data-orderId="{{ patient_detail.id }}">量表详情</a>

                                                </td>
                                                <td>
                                                    {{ patient_detail|get_item:'session_id' }}
                                                    <a href="#modal_OtherTest_{{ patient_detail|get_item:'session_id' }}" data-toggle="modal" data-orderId="{{ patient_detail.id }}">量表详情</a>
                                                </td>
                                                <td>
                                                    <a href="#modal_SelfTest_{{ patient_detail|get_item:'session_id' }}" data-toggle="modal">量表详情</a>
                                                </td>
                                                <td>
                                                    <a href="#modal_cognitionTest_{{ patient_detail|get_item:'session_id' }}" data-toggle="modal">量表详情</a>
                                                </td>
                                                <td>
                                                    <button class="btn btn-warning btn-xs">
                                                        <a onclick='return deleteJob("{{ patient_detail.patient.name }}", "{{ patient_detail.create_time }}");' href="/patients/del_followup?patient_session_id={{ patient_detail.id }}&patient_id={{ patient_detail.patient_id }}" style="color:white;">删除</a>
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
					                </tbody>
				                </table>

			                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static '/js/jquery-radio-beauty.js'%}"></script>
<script>
    $(document).ready(function(){
         $("input[type='radio']").labelauty();
        });

    function deleteJob(id, date)
    {
        var text = "确定要删除" + id + "患者" + date + "的复诊信息吗?"
         if(confirm(text))
         {
             return true;
         }else{
             return false;
    	 }
    }
</script>

{% endblock %}